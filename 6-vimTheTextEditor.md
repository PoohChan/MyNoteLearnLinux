## 第六章 vim文本编辑器
### 一、vi和vim

绝大多数配置文件都是简单的ASCII码，必须要熟悉一个文字编辑器。vi相比其他编辑器存在优势是所有UNIX-LIKE系统下都内置vi，一些软件的编辑接口会主动调用vi（如crontab, visudo, edquota等）。而vim是vi的进阶版，有行数显示，颜色显示等功能。
### 二、vi的使用
vi分为三种模式，命令模式，编辑模式，命令行模式。

* 命令模式(command mode)
  
用vi打开文件时就进入一般指令模式了。可以上下左右移动光标，翻页。可以删除字符，删除整行。可以复制，粘贴。

* 编辑模式(insert mode)
  
上一种模式是无法编辑文本的。在按下"i, I, o, O, a, A, r, R"下任意一个字母，才能进入编辑模式。进入后在坐下方会显示"REPLACE"或"INSERT"。按"esc"回到一般命令模式。

* 命令行模式(command-line mode)

在一般模式下按":, /, ?"任意一个按钮进入。该模式可以搜索，读取，存盘，大量代替字符，离开vi，显示行号等。

### 三、vi按键说明
* 第一部分。命令模式，复制粘贴，光标移动

|移动光标的方式 ||
| :--- | :--- |
| h 或者 左箭头← | 光标向左移动一个字符 |
| j 或者 下箭头↓ | 光标向下移动一个字符 |
| k 或者 上箭头↑ | 光标向上移动一个字符 |
| j 或者 右箭头→ | 光标向右移动一个字符 |
| 按一个数字，再按一个移动命令，</br>就会移动那么多单位。</br>比如 30j 就是向下移动30行。</br> 左右移动会局限在一行中 ||
|ctrl+f 或 PageDown| 向下翻页 |
|ctrl+b 或 PageUp| 向上翻页 |
|ctrl+d| 向下移动半页 |
|ctrl+u| 向上移动半页 |
| n\<space\> | 先按数字n，再按空格。</br>光标向后移动n个字符</br>不受一行局限，会换行|
|0 或 home | 到行首 |
|$ 或 end | 到行尾 |
|H|移动到屏幕第一行|
|M|移动到屏幕中间那一行|
|L|移动到屏幕最后那一行|
| G | 移动到文件尾部 |
| nG | 移动到文件第n行 |
| gg | 移动到文件第一行 |
| n\<Enter\>|向下移动n行|

|搜索和替换||
|:---|:---|
|/word|向下搜索word单词|
|?word|向上搜索word单词|
|n|搜索后继续向下搜索下一个单词|
|N|搜索后继续向上搜索下一个单词|
|:n1,n2s/word1/word2/g|n1, n2为数字，</br>在n1和n2行之间搜索word1</br>并且将其替换为word2（常用）|
|:1,$s/word1/word2/g|从第一行到最后一行搜索word1</br>并且将其替换为word2（常用）|
|:1,$s/word1/word2/gc|从第一行到最后一行搜索word1</br>并且将其替换为word2<br>且在替换前让使用者确认是否替换（常用）|

|删除复制粘贴||
|:---|:---|
|x, X|x表示向后删除一个字符，X表示向前删除一个字符（常用）|
|nx|向后删除n个字符|
|dd|删除光标所在一整行（常用）|
|ndd|删除光标下面n行内容（常用）|
|d1G|删除第一行到光标所在行的全部内容|
|dG|删除光标所在行到最后一行的全部内容|
|d$|删除光标所在处到本行最后一个字符|
|d0|删除本行第一个字符到光标所在处|
|yy|复制光标所在行一行内容（常用）|
|nyy|复制光标向下n行内容（常用）|
|y1G|复制第一行到光标所在行的内容|
|yG|复制光标所在行到最后一行内容|
|y0|复制本行第一个字符到光标所在处|
|y$|复制光标处到本行最后一个字符|
|p, P|p为将已经复制内容粘贴到光标的下一行，P为粘贴到上一行|
|J|将光标所在行和下一行合并|
|u|撤销上一步（常用）|
|c|复原上一步动作（常用）|
|.|重复上一步操作（常用）|

* 第二部分。编辑模式
  
|插入或代替||
|:---|:---|
|i,I|insert mode, i从光标当前插入。I从本行第一行非空字符处插入|
|a,A|insert mode, a从光标的下一个字符出插入，A移动到光标所在行最后一个字符|
|o,O|insert mode, o从光标的下一行插入，自动换行。O从光标上一行插入，自动换行|
|r,R|r只会替代光标所指字母一次然后退出编辑模式，R会一直向后代替直到按下esc键|

* 第三部分。命令行模式

|保存离开命令||
|:---|:---|
|:w|将更改的数据保存|
|:w!|将只读数据强制保存，能不能保存还是和权限有关|
|:q|离开文件|
|:q!|强制离开文件不保存|
|!在vi中有强制的含义||
|:wq|保存后离开|
|ZZ|文件没更改则不存储离开，有更改则存储离开|
|文件如果有保存的话，会对文件记录本身有影响||
|:w [filename]|将编辑的数据存入一个新文件（类似另存为）|
|:r [filename]|在编辑的数据中读入另一个文件，将filename这个文件内容插入到光标下一行|
|n1,n2 w [filename]|将n1行到n2行的内容保存到filename文件中|
|:! command|暂时离开vi到命令行执行command，显示结果，按提示返回vi界面|
|:e!|将更改项目复原到开始状态，等于多次u|

|vi 环境变更（暂时）||
|:---|:---|
|:set nu|显示行号|
|:set nonu|取消显示行号|

数字在vi中是有意义的，代表作多少次动作。这些命令不是全部，但是基本会用就很行了。额外需要可以自行搜索。

练习必不可缺。

### 四、vim的暂存，恢复，打开时的警告
编辑时被某种原因中断了。如退出终端界面，断电等。按下 `ls -al` 会看到暂时存盘的文件swp。再打开文件有提示信息，可能是有其他人正在编辑该文件，或者上次打开被中断强制退出。按照vim出现提示做即可。

### 五、vim额外功能
vim 会显示光标位置，有针对文件语言有特殊颜色显示，针对语法错误有显示。进入文件左下角会显示文件位置，多少行多少字符。右下角显示光标所在行第几个字符的位置，百分比指的是当前屏幕内容占整个文件的百分比。

1. 区块选择(visual block)

之前操作都是按照行进行操作的，可以按照区块进行操作。通过按键将区块的文本选择，然后可以进行复制删除粘贴。

|区块选择按键||
|:---|:---|
|v|字符选择，光标经过白底显示，白底显示的文字就是选择了的|
|V|行选择，光标经过的行选择|
|Ctrl+v|区块选择，按照光标移动选择出长方形|
|y|复制区块|
|d|删除区块|
|p|粘贴区块|

如果想要批量操作行的内容时，这个功能就很有用了。

2. 多文件编辑

假设一个场景，需要将一个文件中的几行内容复制到另一个文件中。可以鼠标选择复制一部分再打开另一个文件粘贴进入，也可以同时打开多个文件。

|多文件编辑||
|:---|:---|
|:n|编辑下一个文件|
|:N|编辑上一个文件|
|:files|列出vim打开的所有文件|

比如想要在几个文件间复制粘贴内容，做法如下:

   * `vim file1 file2 file3` 打开多个文件
   * `:files` 观察打开的文件
   * `4yy` 在第一个文件中复制4行
   * `:n` 切换到下一个文件，左下角会有提示第二个文件的名称
   * 按下 `G` 来到最后一行，按下 `p` 进行粘贴，`:w` 保存
   * 按下`:qa`保存退出

3. 多窗口功能

按下`:sp [filename]`就会分屏，如果不写filename就把自己分成两个屏幕。按下Ctrl+w松开，按下上下箭头进行切换屏幕。
|多窗口按键||
|:---|:---|
|:sp [filename]|将filename分屏显示，缺省就分自己|
|Ctrl+w+j</br>Ctrl+w+↓|按下Ctrl+w松开，按j或者下箭头进行切屏。切屏后下方的文件名称加粗显示|
|Ctrl+w+k</br>Ctrl+w+↑|按下Ctrl+w松开，按j或者上箭头进行切屏。切屏后下方的文件名称加粗显示|
|:qa, :q|q是推出当前屏幕，qa退出所有屏幕|

4. 文字补全功能

(使用vim写代码什么的太过硬核，还是用vscode什么的远程或者写完再放到Linux上面吧)

5. vim环境设置和记录：~/.vimrc, ~/.viminfo

~/.viminfo会记录下vim中的动作。所以光标移动搜索高亮等动作结果推出后再进来还会有。而在~/.vimrc中会记录关于vim的设置项，如永久显示行号等。没有文件创建出来即可。在配置文件中则加不加冒号都可以。
|vim环境变量参数||
|:---|:---|
|:set nu, :set nonu|显示行号，取消显示行号|
|:nohl|取消高亮|

### 六、其他vim使用注意事项

可能会有编码问题显示中文的问题。也可能会有著名的windows换行和Linux换行问题，所谓历史遗留下来的CR LF，老式的打字机什么的。

### 七、练习








